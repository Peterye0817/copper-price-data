# 工作流名称
name: Sync File from Gitee

# (重要!) 授权工作流写入仓库内容的权限
permissions:
  contents: write

# 工作流触发条件
on:
  schedule:
    - cron: '0 13 * * *'
  workflow_dispatch:

# 任务
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出 GitHub 仓库
      - name: Checkout GitHub Repo
        uses: actions/checkout@v4

      # 2. 克隆 Gitee 仓库
      - name: Clone Gitee Repo
        run: |
          git clone ${{ secrets.GITEE_REPO_URL }} gitee-temp
        
      # 3. 从 Gitee 复制所需文件
      # !!! 请确认这里的源文件路径和目标路径是否正确 !!!
      - name: Copy file from Gitee
        run: |
          # 假设文件在 Gitee 仓库根目录，并复制到 GitHub 仓库根目录
          cp gitee-temp/copper_forex_daily.csv ./

      # 4. 提交并推送到 GitHub (已修正)
      - name: Commit and Push to GitHub
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # 只添加您关心的文件，避免了 "embedded repository" 警告
          git add copper_forex_daily.csv
          
          # 检查是否有变动，然后才提交
          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            echo "Changes detected. Committing and pushing..."
            git commit -m "chore: 自动同步 Gitee 文件"
            git push
          fi
